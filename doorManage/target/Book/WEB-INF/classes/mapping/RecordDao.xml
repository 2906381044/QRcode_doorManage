<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dao.LoaningRecordDao">

	<insert id="save" parameterType="com.entity.LoaningRecord">
		INSERT INTO loaning_record
		(
		user_id,
		book_id,
		start_time,
		status
		) VALUES (
		#{userId},
		#{bookId},
		#{startTime},
		#{status}
		)
	</insert>

	<select id="queryList" parameterType="map" resultType="com.entity.LoaningRecord">
		SELECT id id,user_id userId,book_id bookId,start_time startTime,status status FROM loaning_record
		<where>
			<if test="params.status != null and params.status != ''">
				and status = #{params.status}
			</if>
			<if test="params.userId != null and params.userId != '' and params.userId != 'admin'">
				and user_id like "%"#{params.userId}"%"
			</if>
			<if test="params.bookId != null and params.bookId != ''">
				and book_id like "%"#{params.bookId}"%"
			</if>
		</where>
	</select>
	
	<update id="update">
		update loaning_record 
		<set>
			status = '已审批'
		</set>
		<where>
			id = #{id}		
		</where>
	</update>

</mapper>